# Документ требований: FATOS.pro

## Введение

FATOS.pro — веб-платформа для нумерологических расчетов, предоставляющая пользователям инструменты для вычисления Квадрата Пифагора, числа судьбы и матрицы судьбы на основе даты рождения. Платформа поддерживает многоязычность (русский/английский), интеграцию с платежными системами и административную панель для управления контентом.

## Глоссарий

- **Платформа**: Веб-приложение FATOS.pro
- **Калькулятор**: Компонент для ввода даты рождения и инициации расчетов
- **Квадрат_Пифагора**: Нумерологическая сетка 3x3 с рабочими числами
- **Число_Судьбы**: Нумерологическое значение, вычисленное из даты рождения
- **Матрица_Судьбы**: Расширенный нумерологический расчет
- **Рабочие_Числа**: Промежуточные значения для построения Квадрата Пифагора
- **Пользователь**: Зарегистрированный или анонимный посетитель платформы
- **Администратор**: Пользователь с правами управления контентом
- **Расчет**: Сохраненный результат нумерологического вычисления
- **Заказ**: Транзакция оплаты за премиум-функции
- **Статья**: Информационный контент с описаниями значений
- **Платежная_Система**: ЮKassa или Stripe
- **Вебхук**: HTTP-запрос от платежной системы о статусе платежа
- **База_Данных**: PostgreSQL хранилище данных
- **UI_Компонент**: Переиспользуемый элемент интерфейса

## Требования

### Требование 1: Инициализация проекта

**User Story:** Как разработчик, я хочу настроить базовую структуру проекта, чтобы начать разработку платформы.

#### Критерии приемки

1. Платформа ДОЛЖНА быть построена на Next.js с App Router и TypeScript
2. Платформа ДОЛЖНА использовать TailwindCSS для стилизации
3. Платформа ДОЛЖНА подключать Prisma в качестве ORM для работы с PostgreSQL
4. Платформа ДОЛЖНА быть готова к деплою на Netlify

### Требование 2: Многоязычная поддержка

**User Story:** Как пользователь, я хочу использовать платформу на русском или английском языке, чтобы комфортно работать с интерфейсом.

#### Критерии приемки

1. Платформа ДОЛЖНА поддерживать русский и английский языки через библиотеку next-intl
2. КОГДА пользователь выбирает язык, Платформа ДОЛЖНА отображать весь интерфейс на выбранном языке
3. Платформа ДОЛЖНА сохранять выбор языка между сессиями
4. Платформа ДОЛЖНА определять язык по умолчанию на основе настроек браузера пользователя

### Требование 3: Калькулятор даты рождения

**User Story:** Как пользователь, я хочу ввести дату рождения, чтобы получить нумерологические расчеты.

#### Критерии приемки

1. Калькулятор ДОЛЖЕН принимать дату рождения в формате день, месяц, год
2. КОГДА пользователь вводит некорректную дату, Калькулятор ДОЛЖЕН отображать сообщение об ошибке
3. КОГДА пользователь вводит дату позже текущей, Калькулятор ДОЛЖЕН отображать сообщение об ошибке
4. КОГДА пользователь вводит корректную дату, Калькулятор ДОЛЖЕН инициировать расчеты
5. Калькулятор ДОЛЖЕН поддерживать даты с 1900 года по текущий год

### Требование 4: Расчет рабочих чисел

**User Story:** Как система, я хочу вычислять рабочие числа из даты рождения, чтобы построить Квадрат Пифагора.

#### Критерии приемки

1. КОГДА Калькулятор получает дату рождения, Платформа ДОЛЖНА вычислить четыре рабочих числа согласно алгоритму Пифагора
2. Платформа ДОЛЖНА вычислять первое рабочее число как сумму всех цифр даты рождения
3. Платформа ДОЛЖНА вычислять второе рабочее число как сумму цифр первого рабочего числа
4. Платформа ДОЛЖНА вычислять третье рабочее число как разность первого рабочего числа и удвоенной первой цифры дня рождения
5. Платформа ДОЛЖНА вычислять четвертое рабочее число как сумму цифр третьего рабочего числа
6. ДЛЯ ВСЕХ корректных дат рождения, повторное вычисление ДОЛЖНО возвращать идентичные рабочие числа

### Требование 5: Отображение Квадрата Пифагора

**User Story:** Как пользователь, я хочу видеть Квадрат Пифагора с заполненными ячейками, чтобы интерпретировать результаты.

#### Критерии приемки

1. КОГДА рабочие числа вычислены, Платформа ДОЛЖНА отобразить сетку 3x3
2. Платформа ДОЛЖНА заполнить каждую ячейку сетки соответствующими цифрами из даты рождения и рабочих чисел
3. Платформа ДОЛЖНА отображать количество повторений каждой цифры от 1 до 9 в соответствующих ячейках
4. КОГДА цифра отсутствует, Платформа ДОЛЖНА отображать пустую ячейку или нулевое значение
5. Квадрат_Пифагора ДОЛЖЕН быть визуально структурирован как таблица 3x3

### Требование 6: Расчет числа судьбы

**User Story:** Как пользователь, я хочу узнать свое число судьбы, чтобы получить дополнительную нумерологическую информацию.

#### Критерии приемки

1. КОГДА Калькулятор получает дату рождения, Платформа ДОЛЖНА вычислить Число_Судьбы
2. Платформа ДОЛЖНА вычислять Число_Судьбы как итеративную сумму всех цифр даты до получения однозначного числа от 1 до 9 или мастер-числа 11, 22, 33
3. Платформа ДОЛЖНА отображать Число_Судьбы вместе с его описанием
4. ДЛЯ ВСЕХ корректных дат рождения, повторное вычисление ДОЛЖНО возвращать идентичное Число_Судьбы

### Требование 7: Базовый расчет матрицы судьбы

**User Story:** Как пользователь, я хочу получить базовый расчет матрицы судьбы, чтобы расширить нумерологический анализ.

#### Критерии приемки

1. КОГДА Калькулятор получает дату рождения, Платформа ДОЛЖНА вычислить базовую Матрицу_Судьбы
2. Платформа ДОЛЖНА вычислять ключевые позиции матрицы на основе даты рождения
3. Платформа ДОЛЖНА отображать результаты матрицы в структурированном виде
4. Платформа ДОЛЖНА предоставлять краткие описания для каждой позиции матрицы

### Требование 8: UI-компоненты

**User Story:** Как разработчик, я хочу иметь набор переиспользуемых UI-компонентов, чтобы обеспечить консистентность интерфейса.

#### Критерии приемки

1. Платформа ДОЛЖНА содержать UI_Компонент для кнопок с вариантами стилей (primary, secondary, outline)
2. Платформа ДОЛЖНА содержать UI_Компонент для текстовых полей ввода с валидацией
3. Платформа ДОЛЖНА содержать UI_Компонент для карточек контента
4. Платформа ДОЛЖНА содержать UI_Компонент для модальных окон
5. Все UI_Компоненты ДОЛЖНЫ быть адаптивными для мобильных и десктопных устройств
6. Все UI_Компоненты ДОЛЖНЫ поддерживать темизацию через TailwindCSS

### Требование 9: Модель данных пользователя

**User Story:** Как система, я хочу хранить информацию о пользователях, чтобы обеспечить персонализацию и аутентификацию.

#### Критерии приемки

1. База_Данных ДОЛЖНА содержать модель User с полями: id, email, имя, дата регистрации, язык предпочтений
2. КОГДА пользователь регистрируется, Платформа ДОЛЖНА создать запись User в База_Данных
3. Платформа ДОЛЖНА хранить пароли в хешированном виде
4. Платформа ДОЛЖНА обеспечивать уникальность email для каждого пользователя

### Требование 10: Модель данных расчетов

**User Story:** Как пользователь, я хочу сохранять свои расчеты, чтобы возвращаться к ним позже.

#### Критерии приемки

1. База_Данных ДОЛЖНА содержать модель Calculation с полями: id, userId, дата рождения, результаты расчетов, дата создания
2. КОГДА пользователь выполняет расчет, Платформа ДОЛЖНА сохранить Расчет в База_Данных
3. Платформа ДОЛЖНА связывать Расчет с User через userId
4. Платформа ДОЛЖНА позволять анонимным пользователям выполнять расчеты без сохранения

### Требование 11: Модель данных заказов

**User Story:** Как система, я хочу отслеживать платежные транзакции, чтобы управлять доступом к премиум-функциям.

#### Критерии приемки

1. База_Данных ДОЛЖНА содержать модель Order с полями: id, userId, сумма, валюта, статус, платежная система, дата создания
2. КОГДА пользователь инициирует оплату, Платформа ДОЛЖНА создать Заказ со статусом "pending"
3. КОГДА платеж подтвержден, Платформа ДОЛЖНА обновить статус Заказа на "completed"
4. КОГДА платеж отклонен, Платформа ДОЛЖНА обновить статус Заказа на "failed"

### Требование 12: Модель данных статей

**User Story:** Как администратор, я хочу управлять информационным контентом, чтобы предоставлять пользователям описания нумерологических значений.

#### Критерии приемки

1. База_Данных ДОЛЖНА содержать модель Article с полями: id, заголовок, содержание, категория, язык, дата публикации
2. Платформа ДОЛЖНА поддерживать создание, редактирование и удаление Статья через административный интерфейс
3. Платформа ДОЛЖНА связывать Статья с нумерологическими значениями (числа, позиции матрицы)
4. Платформа ДОЛЖНА отображать соответствующие Статья при просмотре результатов расчетов

### Требование 13: Административная панель

**User Story:** Как администратор, я хочу управлять контентом платформы, чтобы обновлять описания и информацию.

#### Критерии приемки

1. Платформа ДОЛЖНА предоставлять административный интерфейс, доступный только Администратор
2. КОГДА Администратор аутентифицирован, Платформа ДОЛЖНА отображать панель управления
3. Администратор ДОЛЖЕН иметь возможность создавать, редактировать и удалять Статья
4. Администратор ДОЛЖЕН иметь возможность просматривать статистику использования платформы
5. Платформа ДОЛЖНА логировать все действия Администратор

### Требование 14: Интеграция с ЮKassa

**User Story:** Как пользователь из России, я хочу оплачивать премиум-функции через ЮKassa, чтобы использовать привычные методы оплаты.

#### Критерии приемки

1. ГДЕ пользователь находится в регионе РФ, Платформа ДОЛЖНА использовать ЮKassa в качестве Платежная_Система
2. КОГДА пользователь инициирует оплату, Платформа ДОЛЖНА создать платежную сессию в ЮKassa
3. Платформа ДОЛЖНА перенаправлять пользователя на страницу оплаты ЮKassa
4. КОГДА платеж завершен, Платформа ДОЛЖНА получить Вебхук от ЮKassa
5. Платформа ДОЛЖНА верифицировать подпись Вебхук от ЮKassa перед обработкой

### Требование 15: Интеграция со Stripe

**User Story:** Как пользователь из Европы, я хочу оплачивать премиум-функции через Stripe, чтобы использовать международные методы оплаты.

#### Критерии приемки

1. ГДЕ пользователь находится за пределами РФ, Платформа ДОЛЖНА использовать Stripe в качестве Платежная_Система
2. КОГДА пользователь инициирует оплату, Платформа ДОЛЖНА создать платежную сессию в Stripe
3. Платформа ДОЛЖНА перенаправлять пользователя на страницу оплаты Stripe
4. КОГДА платеж завершен, Платформа ДОЛЖНА получить Вебхук от Stripe
5. Платформа ДОЛЖНА верифицировать подпись Вебхук от Stripe перед обработкой

### Требование 16: Обработка вебхуков платежных систем

**User Story:** Как система, я хочу обрабатывать уведомления от платежных систем, чтобы обновлять статусы заказов в реальном времени.

#### Критерии приемки

1. КОГДА Платформа получает Вебхук, Платформа ДОЛЖНА верифицировать его подлинность
2. ЕСЛИ Вебхук не прошел верификацию, Платформа ДОЛЖНА отклонить запрос и залогировать попытку
3. КОГДА Вебхук подтверждает успешный платеж, Платформа ДОЛЖНА обновить соответствующий Заказ на статус "completed"
4. КОГДА Вебхук сообщает об ошибке платежа, Платформа ДОЛЖНА обновить соответствующий Заказ на статус "failed"
5. Платформа ДОЛЖНА отправлять ответ 200 OK платежной системе после успешной обработки Вебхук
6. Платформа ДОЛЖНА обеспечивать идемпотентность обработки Вебхук для предотвращения дублирования

### Требование 17: Деплой на Netlify

**User Story:** Как разработчик, я хочу развернуть платформу на Netlify, чтобы обеспечить доступность для пользователей.

#### Критерии приемки

1. Платформа ДОЛЖНА быть настроена для деплоя на Netlify
2. Платформа ДОЛЖНА использовать серверные функции Netlify для API-эндпоинтов
3. Платформа ДОЛЖНА подключаться к внешней База_Данных PostgreSQL
4. КОГДА код обновляется в основной ветке, Платформа ДОЛЖНА автоматически деплоиться на Netlify
5. Платформа ДОЛЖНА использовать переменные окружения для хранения секретных ключей

### Требование 18: Адаптивный дизайн

**User Story:** Как пользователь, я хочу использовать платформу на любом устройстве, чтобы получать расчеты в удобное время.

#### Критерии приемки

1. Платформа ДОЛЖНА корректно отображаться на экранах шириной от 320px до 2560px
2. Платформа ДОЛЖНА адаптировать расположение элементов для мобильных устройств (ширина < 768px)
3. Квадрат_Пифагора ДОЛЖЕН масштабироваться для корректного отображения на мобильных устройствах
4. Все интерактивные элементы ДОЛЖНЫ иметь размер не менее 44x44px для удобства касания на мобильных устройствах

### Требование 19: Производительность расчетов

**User Story:** Как пользователь, я хочу получать результаты расчетов быстро, чтобы не ждать загрузки.

#### Критерии приемки

1. КОГДА пользователь инициирует расчет, Платформа ДОЛЖНА вернуть результаты в течение 500 миллисекунд
2. Платформа ДОЛЖНА кешировать результаты расчетов для повторных запросов с идентичными датами
3. Платформа ДОЛЖНА выполнять все нумерологические вычисления на стороне клиента для минимизации задержек сети

### Требование 20: Безопасность данных

**User Story:** Как пользователь, я хочу быть уверенным в безопасности моих данных, чтобы доверять платформе.

#### Критерии приемки

1. Платформа ДОЛЖНА использовать HTTPS для всех соединений
2. Платформа ДОЛЖНА хешировать пароли с использованием bcrypt или аналогичного алгоритма
3. Платформа ДОЛЖНА защищать API-эндпоинты от CSRF-атак
4. Платформа ДОЛЖНА валидировать и санитизировать все пользовательские вводы
5. Платформа ДОЛЖНА ограничивать количество запросов от одного IP-адреса для предотвращения DDoS-атак
6. Платформа ДОЛЖНА хранить секретные ключи платежных систем в переменных окружения, недоступных клиенту
