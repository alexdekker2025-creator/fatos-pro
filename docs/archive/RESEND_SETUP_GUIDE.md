# Настройка Resend для FATOS.pro

## Шаг 1: Регистрация в Resend

1. Перейдите на https://resend.com
2. Нажмите "Sign Up" или "Get Started"
3. Зарегистрируйтесь через GitHub или email
4. Подтвердите email (если регистрировались через email)

## Шаг 2: Создание API ключа

1. После входа перейдите в раздел **API Keys**
2. Нажмите **"Create API Key"**
3. Введите название: `FATOS.pro Production`
4. Выберите разрешения: **Full Access** (или минимум: Send emails)
5. Нажмите **"Create"**
6. **ВАЖНО:** Скопируйте ключ сразу! Он показывается только один раз
7. Сохраните ключ в безопасном месте

Формат ключа: `re_xxxxxxxxxxxxxxxxxxxxxxxxxx`

## Шаг 3: Верификация домена (Рекомендуется)

### Зачем нужна верификация домена?
- Письма будут отправляться с вашего домена (noreply@fatos.pro)
- Выше deliverability (письма не попадают в спам)
- Профессиональный вид
- Больше лимит отправки

### Как верифицировать:

1. В Resend перейдите в **Domains**
2. Нажмите **"Add Domain"**
3. Введите: `fatos.pro`
4. Resend покажет DNS записи, которые нужно добавить

### DNS записи для добавления:

Вам нужно добавить следующие записи в настройках DNS вашего домена (где куплен домен):

**Записи будут примерно такими:**

```
Type: TXT
Name: _resend
Value: resend-verification=xxxxxxxxxxxxxx
TTL: 3600

Type: MX
Name: @
Value: feedback-smtp.resend.com
Priority: 10
TTL: 3600

Type: TXT
Name: @
Value: v=spf1 include:_spf.resend.com ~all
TTL: 3600

Type: TXT
Name: resend._domainkey
Value: p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC...
TTL: 3600
```

**Где добавлять DNS записи:**
- Если домен куплен на **Reg.ru** → Личный кабинет → Домены → DNS-серверы и зона
- Если на **Cloudflare** → DNS → Records
- Если на **Namecheap** → Domain List → Manage → Advanced DNS

### Проверка верификации:

1. После добавления DNS записей подождите 5-30 минут
2. В Resend нажмите **"Verify Domain"**
3. Если все правильно, статус изменится на **"Verified"** ✅

## Шаг 4: Добавление API ключа в Vercel

### Через веб-интерфейс Vercel:

1. Откройте https://vercel.com
2. Выберите проект **fatos-pro**
3. Перейдите в **Settings** → **Environment Variables**
4. Нажмите **"Add New"**
5. Заполните:
   - **Key:** `RESEND_API_KEY`
   - **Value:** `re_xxxxxxxxxxxxxxxxxxxxxxxxxx` (ваш ключ)
   - **Environment:** Выберите все (Production, Preview, Development)
6. Нажмите **"Save"**

### Через Vercel CLI (альтернатива):

```bash
vercel env add RESEND_API_KEY
# Вставьте ключ когда попросит
# Выберите все окружения
```

## Шаг 5: Перезапуск деплоя

После добавления переменной окружения нужно перезапустить деплой:

1. В Vercel перейдите в **Deployments**
2. Найдите последний деплой
3. Нажмите три точки **"..."** → **"Redeploy"**
4. Подтвердите

Или просто сделайте новый коммит:

```bash
git commit --allow-empty -m "Trigger redeploy for Resend API key"
git push origin main
```

## Шаг 6: Тестирование

### Тест 1: Сброс пароля

1. Откройте https://fatos.pro
2. Нажмите **"Войти"**
3. Нажмите **"Забыли пароль?"**
4. Введите ваш email
5. Проверьте почту - должно прийти письмо со ссылкой для сброса

### Тест 2: Верификация email

1. Зарегистрируйте новый аккаунт
2. Перейдите в **Профиль** → **Безопасность**
3. В разделе "Верификация email" нажмите **"Отправить снова"**
4. Проверьте почту - должно прийти письмо с ссылкой для верификации

### Проверка логов в Resend:

1. В Resend перейдите в **Logs**
2. Вы увидите все отправленные письма
3. Можно посмотреть статус доставки, открытия и т.д.

## Шаг 7: Настройка отправителя (опционально)

Если домен верифицирован, можно изменить отправителя в коде:

В файле `lib/services/auth/EmailService.ts` найдите:

```typescript
from: 'FATOS.pro <noreply@fatos.pro>',
```

Можете изменить на:
- `support@fatos.pro` - для поддержки
- `hello@fatos.pro` - для приветственных писем
- `security@fatos.pro` - для писем безопасности

## Лимиты Resend

### Бесплатный план:
- 100 писем в день
- 3,000 писем в месяц
- Все функции доступны

### Платные планы (если нужно больше):
- **Pro:** $20/месяц - 50,000 писем
- **Business:** $80/месяц - 100,000 писем

## Troubleshooting

### Письма не приходят:

1. **Проверьте API ключ:**
   - В Vercel → Settings → Environment Variables
   - Убедитесь что ключ правильный и начинается с `re_`

2. **Проверьте логи в Resend:**
   - Logs → посмотрите статус отправки
   - Если статус "bounced" или "failed" - проверьте email получателя

3. **Проверьте спам:**
   - Письма могут попадать в спам, особенно если домен не верифицирован

4. **Проверьте логи Vercel:**
   - Vercel → Deployments → Functions
   - Посмотрите логи API endpoints для ошибок

### Домен не верифицируется:

1. Подождите дольше (до 48 часов для распространения DNS)
2. Проверьте DNS записи через https://dnschecker.org
3. Убедитесь что записи добавлены точно как показано в Resend

## Полезные ссылки

- Документация Resend: https://resend.com/docs
- Resend Dashboard: https://resend.com/dashboard
- Проверка DNS: https://dnschecker.org
- Тестирование email: https://www.mail-tester.com

## Готово! ✅

После выполнения всех шагов:
- ✅ Сброс пароля работает
- ✅ Верификация email работает
- ✅ Уведомления о 2FA работают
- ✅ Все письма отправляются через Resend

---

**Следующий шаг:** Настройка OAuth провайдеров (Google/Facebook)
