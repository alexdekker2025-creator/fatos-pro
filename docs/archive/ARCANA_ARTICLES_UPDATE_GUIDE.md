# Руководство по обновлению статей арканов

## Обзор

Этот документ описывает процесс удаления старых и добавления новых статей арканов в базу данных.

## Файлы

1. **`prisma/delete-old-arcana-articles.sql`** - Скрипт для удаления старых статей
2. **`prisma/new-arcana-articles-template.sql`** - Шаблон для новых статей (ЗАПОЛНИТЕ!)
3. **`prisma/seed-arcana-articles.sql`** - Старый скрипт (для справки)

## Процесс обновления

### Шаг 1: Проверка текущих статей

Выполните в Neon SQL Editor:

```sql
-- Посмотреть все текущие статьи арканов
SELECT id, title, "relatedValue", language
FROM "Article" 
WHERE category = 'Arcana (Cards)'
ORDER BY "relatedValue", language;

-- Подсчитать количество
SELECT COUNT(*) as "Количество статей"
FROM "Article" 
WHERE category = 'Arcana (Cards)';
```

**Ожидаемый результат:** 44 записи (22 аркана × 2 языка)

### Шаг 2: Заполнение нового шаблона

Откройте файл `prisma/new-arcana-articles-template.sql` и заполните:

1. **Для каждого аркана (0-22):**
   - Замените `'ЗАПОЛНИТЕ: ...'` на реальное описание на русском
   - Замените `'FILL IN: ...'` на реальное описание на английском

2. **Формат описания:**
   ```
   Название аркана
   
   Значение: [основное значение аркана]
   
   Символика: [символы и образы на карте]
   
   В раскладах:
   - Прямое положение: [интерпретация]
   - Перевернутое положение: [интерпретация]
   
   Ключевые слова: [список ключевых слов через запятую]
   ```

3. **Пример заполненного описания:**
   ```sql
   (
     gen_random_uuid(),
     'Дьявол',
     'Аркан XV символизирует искушение, материальные привязанности и зависимости.
     
     Значение: Карта представляет силы, которые держат нас в плену наших желаний и страхов.
     
     Символика: На карте изображен Дьявол с двумя прикованными фигурами, символизирующими добровольное рабство.
     
     В раскладах:
     - Прямое положение: Зависимость, искушение, материализм, страсть
     - Перевернутое положение: Освобождение, преодоление зависимостей, осознание
     
     Ключевые слова: искушение, зависимость, страсть, материализм, освобождение',
     'Arcana (Cards)',
     'ru',
     'arcana_15',
     NOW(),
     NOW()
   ),
   ```

### Шаг 3: Удаление старых статей (опционально)

**ВНИМАНИЕ:** Этот шаг необратим! Сделайте резервную копию базы данных перед выполнением.

Выполните в Neon SQL Editor:

```sql
-- Сначала проверьте, что будет удалено
SELECT id, title, "relatedValue", language
FROM "Article" 
WHERE category = 'Arcana (Cards)'
ORDER BY "relatedValue", language;

-- Если все правильно, выполните удаление
DELETE FROM "Article" WHERE category = 'Arcana (Cards)';

-- Проверьте результат
SELECT COUNT(*) as "Осталось записей" 
FROM "Article" 
WHERE category = 'Arcana (Cards)';
```

**Ожидаемый результат:** 0 записей

### Шаг 4: Добавление новых статей

Выполните заполненный скрипт `prisma/new-arcana-articles-template.sql` в Neon SQL Editor.

**Проверка результата:**

```sql
-- Должно быть 46 записей (23 аркана × 2 языка, включая аркан 0 и 22)
SELECT COUNT(*) as "Всего статей" 
FROM "Article" 
WHERE category = 'Arcana (Cards)';

-- Проверка структуры
SELECT "relatedValue", language, title 
FROM "Article" 
WHERE category = 'Arcana (Cards)' 
ORDER BY "relatedValue", language;
```

### Шаг 5: Проверка в приложении

1. Откройте http://localhost:3001/ru
2. Выполните расчет арканов
3. Проверьте, что статьи загружаются корректно
4. Проверьте на обоих языках (ru и en)

## Альтернативный подход: Обновление через Admin Panel

Если у вас есть административная панель для управления статьями:

1. Войдите в админ-панель: http://localhost:3001/ru/admin
2. Перейдите в раздел "Статьи"
3. Найдите статьи с category = "Arcana (Cards)"
4. Отредактируйте каждую статью вручную

**Преимущества:**
- Визуальный интерфейс
- Предпросмотр изменений
- Безопаснее (меньше риск ошибок)

**Недостатки:**
- Дольше (нужно редактировать 44-46 статей)
- Требует аутентификации

## Структура данных

### Поля таблицы Article

```typescript
{
  id: string;              // UUID, генерируется автоматически
  title: string;           // Название аркана
  content: string;         // Полное описание (может быть длинным)
  category: string;        // Всегда "Arcana (Cards)"
  language: string;        // "ru" или "en"
  relatedValue: string;    // "arcana_0" до "arcana_22"
  publishedAt: DateTime;   // Дата публикации
  updatedAt: DateTime;     // Дата последнего обновления
}
```

### Нумерация арканов

В системе используется нумерация 1-22 для расчетов, но в базе данных:

- `arcana_0` - Шут (альтернативная нумерация)
- `arcana_1` - Маг
- `arcana_2` - Верховная Жрица
- ...
- `arcana_21` - Мир
- `arcana_22` - Шут (основная нумерация для расчетов)

**ВАЖНО:** В расчетах используются арканы 1-22, поэтому:
- Если результат расчета = 22, загружается `arcana_22`
- Аркан 0 (`arcana_0`) используется редко или для специальных случаев

## Резервное копирование

Перед удалением старых статей создайте резервную копию:

```sql
-- Экспорт в CSV (в Neon SQL Editor)
COPY (
  SELECT * FROM "Article" WHERE category = 'Arcana (Cards)'
) TO '/tmp/arcana_backup.csv' WITH CSV HEADER;
```

Или используйте встроенные инструменты Neon для создания snapshot базы данных.

## Откат изменений

Если что-то пошло не так:

1. **Если есть резервная копия:**
   - Восстановите данные из backup
   - Или используйте Neon snapshot

2. **Если нет резервной копии:**
   - Используйте старый скрипт `prisma/seed-arcana-articles.sql`
   - Выполните его в Neon SQL Editor

## Проверка после обновления

### Автоматическая проверка

Запустите тест:

```bash
npm test -- __tests__/lib/arcana/arcanaCalculator.integration.test.ts
```

### Ручная проверка

1. Откройте приложение
2. Выполните расчет для разных дат
3. Проверьте загрузку статей для всех 4 арканов
4. Проверьте на русском и английском языках
5. Проверьте placeholder для несуществующих статей

## Частые вопросы

### Q: Нужно ли перезапускать сервер после обновления статей?

A: Нет, статьи загружаются динамически из базы данных. Изменения видны сразу.

### Q: Что делать, если статья не загружается?

A: Проверьте:
1. Правильность `relatedValue` (должно быть "arcana_X", где X от 0 до 22)
2. Наличие статьи на нужном языке
3. Правильность `category` (должно быть "Arcana (Cards)")

### Q: Можно ли добавить статьи только для некоторых арканов?

A: Да, но рекомендуется заполнить все 23 аркана (0-22) на обоих языках для полноты.

### Q: Как добавить поддержку третьего языка?

A: 
1. Добавьте записи с `language = 'новый_код'` в базу данных
2. Обновите компонент CardOfDay для поддержки нового языка
3. Добавьте переводы в next-intl

## Контакты

Если возникнут проблемы:
- Проверьте логи в Neon Dashboard
- Проверьте Network запросы в DevTools
- Проверьте Console на наличие ошибок

## Следующие шаги

После успешного обновления статей:
1. Протестируйте на production (https://fatos-pro.vercel.app/ru)
2. Соберите feedback от пользователей
3. При необходимости обновите описания
