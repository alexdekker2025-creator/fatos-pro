# Настройка системы отслеживания посещений

## Что было сделано

1. ✅ Добавлены модели `SiteVisit` и `DailyStats` в Prisma схему
2. ✅ Создан API endpoint `/api/track-visit` для записи посещений
3. ✅ Создан API endpoint `/api/admin/visit-stats` для получения статистики
4. ✅ Создан компонент `VisitTracker` для автоматического отслеживания
5. ✅ Создан компонент `VisitStats` для отображения статистики в админ-панели
6. ✅ Добавлена вкладка "Посещения" в админ-панель (ru и en)
7. ✅ Создан скрипт для создания таблиц в базе данных

## Запуск на продакшене

### Вариант 1: Запуск скрипта локально с продакшн БД

Скрипт уже запущен локально и таблицы созданы в базе данных.

### Вариант 2: Проверка работы системы

1. Откройте сайт https://fatos.pro
2. Зайдите в админ-панель: https://fatos.pro/ru/admin
3. Перейдите на вкладку "Посещения"
4. Вы должны увидеть статистику посещений

## Что отслеживается

- **Общее количество посещений** - за все время
- **Посещения за сегодня** - количество визитов сегодня
- **Уникальные посетители** - по IP адресу
- **Посещения за 7 дней** - статистика за неделю
- **Посещения за 30 дней** - статистика за месяц
- **График по дням** - визуализация посещений
- **Топ страниц** - самые популярные страницы

## Структура данных

### Таблица SiteVisit
- `id` - уникальный идентификатор
- `ipAddress` - IP адрес посетителя
- `userAgent` - браузер и устройство
- `path` - путь страницы
- `referrer` - откуда пришел посетитель
- `country` - страна (пока не используется)
- `city` - город (пока не используется)
- `createdAt` - время посещения

### Таблица DailyStats
- `id` - уникальный идентификатор
- `date` - дата
- `uniqueVisitors` - уникальные посетители
- `totalVisits` - всего посещений
- `newUsers` - новые пользователи
- `calculations` - количество расчетов
- `createdAt` - время создания
- `updatedAt` - время обновления

## Автоматическое отслеживание

Компонент `VisitTracker` автоматически отслеживает каждое посещение страницы:
- Добавлен в `app/layout.tsx`
- Отправляет данные на `/api/track-visit`
- Работает на всех страницах сайта
- Не блокирует загрузку страницы

## Безопасность

- API `/api/admin/visit-stats` защищен проверкой админской сессии
- Только администраторы могут видеть статистику
- IP адреса хранятся для подсчета уникальных посетителей
- Нет персональных данных пользователей

## Следующие шаги (опционально)

1. Добавить геолокацию (определение страны и города по IP)
2. Добавить отслеживание событий (клики, расчеты и т.д.)
3. Добавить экспорт статистики в CSV/Excel
4. Добавить фильтры по датам и страницам
5. Добавить real-time обновление статистики
