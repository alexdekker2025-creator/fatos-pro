# API Endpoints - –°–≤–æ–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –°–æ–∑–¥–∞–Ω–æ 13 API endpoints –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 1. Password Reset (3 endpoints)

#### POST `/api/auth/password-reset/request`
- **–§—É–Ω–∫—Ü–∏—è**: –ó–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
- **Rate limiting**: 3 –∑–∞–ø—Ä–æ—Å–∞ / 15 –º–∏–Ω—É—Ç (–ø–æ IP)
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: Email (Zod)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Email enumeration prevention
- **–û—Ç–≤–µ—Ç**: –í—Å–µ–≥–¥–∞ —É—Å–ø–µ—Ö (–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ email)

#### GET `/api/auth/password-reset/verify`
- **–§—É–Ω–∫—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: token (query string)
- **–û—Ç–≤–µ—Ç**: `{ valid: boolean, expired: boolean }`

#### POST `/api/auth/password-reset/confirm`
- **–§—É–Ω–∫—Ü–∏—è**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: token, newPassword (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)
- **–î–µ–π—Å—Ç–≤–∏—è**: 
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π (–∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π)
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
- **–û—Ç–≤–µ—Ç**: –£—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞ (expired/invalid)

---

### 2. Email Verification (2 endpoints)

#### POST `/api/auth/email/verify`
- **–§—É–Ω–∫—Ü–∏—è**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email –∞–¥—Ä–µ—Å–∞
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: token (Zod)
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ emailVerified = true
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
  - Security logging
- **–û—Ç–≤–µ—Ç**: –£—Å–ø–µ—Ö —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### POST `/api/auth/email/resend`
- **–§—É–Ω–∫—Ü–∏—è**: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (session cookie)
- **Rate limiting**: 3 –∑–∞–ø—Ä–æ—Å–∞ / —á–∞—Å (–ø–æ userId)
- **–û—Ç–≤–µ—Ç**: HTTP 429 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

---

### 3. Two-Factor Authentication (5 endpoints)

#### POST `/api/auth/2fa/setup`
- **–§—É–Ω–∫—Ü–∏—è**: –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 2FA
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **–û—Ç–≤–µ—Ç**: 
  ```json
  {
    "secret": "TOTP secret",
    "qrCode": "data:image/png;base64,...",
    "backupCodes": ["XXXX-XXXX", ...]
  }
  ```

#### POST `/api/auth/2fa/confirm`
- **–§—É–Ω–∫—Ü–∏—è**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 2FA
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: 
  - code (6 —Ü–∏—Ñ—Ä)
  - secret (TOTP secret)
  - backupCodes (10 –∫–æ–¥–æ–≤)
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ secret
  - –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ backup –∫–æ–¥–æ–≤
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π
  - Security logging

#### POST `/api/auth/2fa/verify`
- **–§—É–Ω–∫—Ü–∏—è**: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è 2FA –∫–æ–¥–∞ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- **Rate limiting**: 5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç (–ø–æ userId)
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: userId, code (TOTP –∏–ª–∏ backup –∫–æ–¥)
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
  - –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ session cookie
- **–û—Ç–≤–µ—Ç**: HTTP 429 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

#### POST `/api/auth/2fa/disable`
- **–§—É–Ω–∫—Ü–∏—è**: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ 2FA
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è + –ø–∞—Ä–æ–ª—å
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: password
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
  - –£–¥–∞–ª–µ–Ω–∏–µ TOTP secret –∏ backup –∫–æ–¥–æ–≤
  - Security logging

#### POST `/api/auth/2fa/backup-codes/regenerate`
- **–§—É–Ω–∫—Ü–∏—è**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö backup –∫–æ–¥–æ–≤
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è + TOTP/backup –∫–æ–¥
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: code (TOTP –∏–ª–∏ backup –∫–æ–¥)
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 10 –Ω–æ–≤—ã—Ö –∫–æ–¥–æ–≤
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∫–æ–¥–æ–≤
  - Security logging
- **–û—Ç–≤–µ—Ç**: –ù–æ–≤—ã–µ backup –∫–æ–¥—ã

---

### 4. OAuth Integration (4 endpoints)

#### GET `/api/auth/oauth/[provider]/authorize`
- **–§—É–Ω–∫—Ü–∏—è**: –ò–Ω–∏—Ü–∏–∞—Ü–∏—è OAuth flow
- **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã**: google, facebook
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è state parameter (32 bytes)
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ state –≤ cookie (10 –º–∏–Ω—É—Ç)
  - Redirect –Ω–∞ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- **CSRF Protection**: State parameter

#### GET `/api/auth/oauth/[provider]/callback`
- **–§—É–Ω–∫—Ü–∏—è**: –û–±—Ä–∞–±–æ—Ç–∫–∞ OAuth callback
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: code, state (query string)
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ state (CSRF protection)
  - –û–±–º–µ–Ω code –Ω–∞ tokens
  - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –°–æ–∑–¥–∞–Ω–∏–µ/—Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
  - –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
  - Redirect –Ω–∞ /dashboard
- **–û—à–∏–±–∫–∏**: Redirect –Ω–∞ /auth/error —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º error

#### POST `/api/auth/oauth/link`
- **–§—É–Ω–∫—Ü–∏—è**: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: provider (google|facebook), code
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –û–±–º–µ–Ω code –Ω–∞ tokens
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
  - –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
  - Security logging
- **–û—Ç–≤–µ—Ç**: –°–ø–∏—Å–æ–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

#### POST `/api/auth/oauth/unlink`
- **–§—É–Ω–∫—Ü–∏—è**: –û—Ç–≤—è–∑—ã–≤–∞–Ω–∏–µ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: provider, password (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–õ–æ–≥–∏–∫–∞**:
  - –ï—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã ‚Üí —Ä–∞–∑—Ä–µ—à–∏—Ç—å –±–µ–∑ –ø–∞—Ä–æ–ª—è
  - –ï—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–æ–ª—å ‚Üí —Ä–∞–∑—Ä–µ—à–∏—Ç—å –±–µ–∑ –ø–∞—Ä–æ–ª—è
  - –ï—Å–ª–∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä + –µ—Å—Ç—å –ø–∞—Ä–æ–ª—å ‚Üí —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å
  - –ï—Å–ª–∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ ‚Üí –∑–∞–ø—Ä–µ—Ç–∏—Ç—å
- **–î–µ–π—Å—Ç–≤–∏—è**:
  - –£–¥–∞–ª–µ–Ω–∏–µ OAuth –∑–∞–ø–∏—Å–∏
  - Security logging

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Rate Limiting
- **Password reset**: 3 –∑–∞–ø—Ä–æ—Å–∞ / 15 –º–∏–Ω—É—Ç (–ø–æ IP)
- **Email resend**: 3 –∑–∞–ø—Ä–æ—Å–∞ / —á–∞—Å (–ø–æ userId)
- **2FA verify**: 5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç (–ø–æ userId)
- **–û—Ç–≤–µ—Ç**: HTTP 429 + Retry-After header

### Validation (Zod)
- Email format
- Password –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
- TOTP –∫–æ–¥: 6 —Ü–∏—Ñ—Ä
- Backup –∫–æ–¥: XXXX-XXXX —Ñ–æ—Ä–º–∞—Ç
- OAuth provider: enum (google|facebook)
- Token: URL-safe string

### CSRF Protection
- OAuth state parameter (32 bytes, base64url)
- State —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ httpOnly cookie (10 –º–∏–Ω—É—Ç)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ state –ø—Ä–∏ callback

### Session Management
- httpOnly cookies
- secure flag –≤ production
- sameSite: lax
- maxAge: 30 –¥–Ω–µ–π

### Error Handling
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–±—â–∏–µ –æ—à–∏–±–∫–∏ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –¥–µ—Ç–∞–ª–∏
- Email enumeration prevention
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª—å

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Password Reset Flow
```javascript
// 1. –ó–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞
POST /api/auth/password-reset/request
{ "email": "user@example.com" }

// 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
GET /api/auth/password-reset/verify?token=abc123

// 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
POST /api/auth/password-reset/confirm
{ "token": "abc123", "newPassword": "newpass123" }
```

### 2FA Setup Flow
```javascript
// 1. –ò–Ω–∏—Ü–∏–∞—Ü–∏—è
POST /api/auth/2fa/setup
‚Üí { secret, qrCode, backupCodes }

// 2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
POST /api/auth/2fa/confirm
{ "code": "123456", "secret": "...", "backupCodes": [...] }
```

### OAuth Login Flow
```javascript
// 1. Redirect –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
window.location = '/api/auth/oauth/google/authorize'

// 2. Google redirect –æ–±—Ä–∞—Ç–Ω–æ
GET /api/auth/oauth/google/callback?code=...&state=...
‚Üí Redirect to /dashboard + session cookie
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –í—Å–µ 13 endpoints —Å–æ–∑–¥–∞–Ω—ã
2. ‚è≥ Cleanup jobs (—Ç–æ–∫–µ–Ω—ã, –ª–æ–≥–∏)
3. ‚è≥ Admin features (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
4. ‚è≥ Integration tests (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. ‚è≥ Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
app/api/auth/
‚îú‚îÄ‚îÄ password-reset/
‚îÇ   ‚îú‚îÄ‚îÄ request/route.ts
‚îÇ   ‚îú‚îÄ‚îÄ verify/route.ts
‚îÇ   ‚îî‚îÄ‚îÄ confirm/route.ts
‚îú‚îÄ‚îÄ email/
‚îÇ   ‚îú‚îÄ‚îÄ verify/route.ts
‚îÇ   ‚îî‚îÄ‚îÄ resend/route.ts
‚îú‚îÄ‚îÄ 2fa/
‚îÇ   ‚îú‚îÄ‚îÄ setup/route.ts
‚îÇ   ‚îú‚îÄ‚îÄ confirm/route.ts
‚îÇ   ‚îú‚îÄ‚îÄ verify/route.ts
‚îÇ   ‚îú‚îÄ‚îÄ disable/route.ts
‚îÇ   ‚îî‚îÄ‚îÄ backup-codes/
‚îÇ       ‚îî‚îÄ‚îÄ regenerate/route.ts
‚îî‚îÄ‚îÄ oauth/
    ‚îú‚îÄ‚îÄ [provider]/
    ‚îÇ   ‚îú‚îÄ‚îÄ authorize/route.ts
    ‚îÇ   ‚îî‚îÄ‚îÄ callback/route.ts
    ‚îú‚îÄ‚îÄ link/route.ts
    ‚îî‚îÄ‚îÄ unlink/route.ts
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 22.02.2026  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ (13/13 endpoints)  
**–ü—Ä–æ–≥—Ä–µ—Å—Å**: 75% –æ–±—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
