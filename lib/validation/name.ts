/**
 * Модуль для работы с именами в нумерологии
 */

/**
 * Русский алфавит с соответствующими числовыми значениями (циклическая таблица 1-9)
 * 
 * Таблица:
 * 1: А, Б, В, Г, Д, Е, Ё, Ж, З
 * 2: И, Й, К, Л, М, Н, О, П, Р
 * 3: С, Т, У, Ф, Х, Ц, Ч, Ш, Щ
 * 4: Ъ, Ы, Ь, Э, Ю, Я
 */
const RUSSIAN_ALPHABET: Record<string, number> = {
  // 1: А, Б, В, Г, Д, Е, Ё, Ж, З
  'А': 1, 'Б': 2, 'В': 3, 'Г': 4, 'Д': 5, 'Е': 6, 'Ё': 7, 'Ж': 8, 'З': 9,
  // 2: И, Й, К, Л, М, Н, О, П, Р (начинаем с 1 снова)
  'И': 1, 'Й': 2, 'К': 3, 'Л': 4, 'М': 5, 'Н': 6, 'О': 7, 'П': 8, 'Р': 9,
  // 3: С, Т, У, Ф, Х, Ц, Ч, Ш, Щ (начинаем с 1 снова)
  'С': 1, 'Т': 2, 'У': 3, 'Ф': 4, 'Х': 5, 'Ц': 6, 'Ч': 7, 'Ш': 8, 'Щ': 9,
  // 4: Ъ, Ы, Ь, Э, Ю, Я (начинаем с 1 снова)
  'Ъ': 1, 'Ы': 2, 'Ь': 3, 'Э': 4, 'Ю': 5, 'Я': 6,
};

/**
 * Переводит буквы имени в числа и возвращает их сумму (с последующим сведением к однозначному)
 * 
 * Правила:
 * - Используется циклическая таблица 1-9 для русского алфавита
 * - Таблица: 1(А-З), 2(И-Р), 3(С-Щ), 4(Ъ-Я)
 * - Функция суммирует значения всех букв в имени
 * - Затем сводит сумму к однозначному числу (1-9)
 * - Регистр не имеет значения (все буквы приводятся к верхнему регистру)
 * - Пробелы и небуквенные символы игнорируются
 * 
 * @param name - Имя для обработки
 * @returns Однозначное число (1-9) - сумма букв имени
 * 
 * @example
 * sumNameLetters('Алексей')
 * // А(1) + Л(4) + Е(6) + К(3) + С(1) + Е(6) + Й(2) = 23 -> 2+3 = 5
 */
export function sumNameLetters(name: string): number {
  // Приводим к верхнему регистру и удаляем пробелы
  const normalizedName = name.toUpperCase().trim();
  
  let sum = 0;
  
  // Проходим по каждому символу
  for (const char of normalizedName) {
    // Если символ есть в алфавите, добавляем его значение
    if (RUSSIAN_ALPHABET[char]) {
      sum += RUSSIAN_ALPHABET[char];
    }
    // Пробелы и другие символы игнорируются
  }
  
  // Сводим к однозначному числу (1-9)
  while (sum > 9) {
    const digits = sum.toString().split('');
    sum = digits.reduce((acc, digit) => acc + parseInt(digit, 10), 0);
  }
  
  return sum;
}

/**
 * Валидирует имя
 * 
 * @param name - Имя для валидации
 * @returns true если имя содержит хотя бы одну букву русского алфавита
 */
export function validateName(name: string): boolean {
  if (!name || name.trim().length === 0) {
    return false;
  }
  
  const normalizedName = name.toUpperCase().trim();
  
  // Проверяем, что есть хотя бы одна буква русского алфавита
  for (const char of normalizedName) {
    if (RUSSIAN_ALPHABET[char]) {
      return true;
    }
  }
  
  return false;
}
